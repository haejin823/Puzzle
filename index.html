<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì§ì†Œ í¼ì¦ (10Ã—10)</title>

<!-- PWA ì„¤ì • -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
  /* ì „ì²´ ë°°ê²½ & ê¸°ë³¸ í°íŠ¸ */
  body {
    font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    text-align: center;
    margin: 0;
    padding: 16px 0 24px;
    background: radial-gradient(circle at top, #23395b, #0b1020);
    color: #fdfdfd;
  }

  h2 {
    margin: 4px 0 10px;
    font-size: 18px;
  }

  #game-container {
    display: inline-block;
    padding: 12px 14px 18px;
    border-radius: 12px;
    background: rgba(0, 0, 0, 0.3);
    box-shadow: 0 0 20px rgba(0,0,0,0.6);
    max-width: 100vw;
  }

  /* â˜… í¼ì¦íŒ í¬ê¸°ë¥¼ í™”ë©´ í­ ê¸°ì¤€ìœ¼ë¡œ ì¡°ì • */
  #board {
    width: min(92vw, 540px);   /* ëª¨ë°”ì¼ì—ì„œëŠ” ê±°ì˜ ê½‰ ì°¨ê³ , PCì—ì„  ìµœëŒ€ 540px */
    height: min(92vw, 540px);  /* ì •ì‚¬ê°í˜• ìœ ì§€ */
    border: 2px solid #f5f5f5;
    margin: 0 auto 10px auto;
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    grid-template-rows: repeat(10, 1fr);
    gap: 0;
    position: relative;
    background: #111;
  }

  /* â˜… ê° ì¡°ê°ì€ ì¹¸ í¬ê¸°ì— ë§ì¶° ìë™ìœ¼ë¡œ ëŠ˜ì–´ë‚˜ë„ë¡ 100% */
  .piece {
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    cursor: pointer;
    /* background-size, positionì€ JSì—ì„œ ë™ì ìœ¼ë¡œ ì„¤ì • */
    transition: transform 0.08s, box-shadow 0.08s;
  }

  .piece:hover {
    transform: scale(1.04);
    box-shadow: 0 0 8px rgba(255,255,255,0.4);
  }

  .selected {
    outline: 2px solid #ffeb3b;
    box-shadow: 0 0 10px rgba(255,235,59,0.8);
  }

  #controls {
    margin-top: 4px;
  }

  button {
    padding: 7px 14px;
    font-size: 13px;
    cursor: pointer;
    border-radius: 4px;
    border: 1px solid #ccc;
    background: #fafafa;
    margin: 0 4px;
  }

  button:hover {
    background: #eee;
  }

  #info {
    margin-top: 4px;
    font-size: 13px;
  }
</style>
</head>
<body>

<h2>ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì§ì†Œ í¼ì¦ (10Ã—10)</h2>

<div id="game-container">
  <div id="board"></div>
  <div id="controls">
    <button id="shuffleBtn">ğŸ”€ ì„ê¸°</button>
    <button id="resetBtn">ì›ë³¸ ìœ„ì¹˜ë¡œ ë¦¬ì…‹</button>
  </div>
  <div id="info">
    <span id="moveCount">ì´ë™ íšŸìˆ˜: 0</span>
  </div>
</div>

<script>
  const ROWS = 10;
  const COLS = 10;
  const IMAGE_URL = "christmas.jpg"; // í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì´ë¯¸ì§€ íŒŒì¼ ì´ë¦„

  let selectedIndex = null;
  let moveCounter = 0;

  const board = document.getElementById("board");
  const moveCountSpan = document.getElementById("moveCount");

  function init() {
    board.innerHTML = "";
    selectedIndex = null;
    moveCounter = 0;
    updateMoveCount();

    for (let i = 0; i < ROWS * COLS; i++) {
      const pieceDiv = document.createElement("div");
      pieceDiv.classList.add("piece");
      pieceDiv.dataset.index = i;
      pieceDiv.dataset.piece = i;

      applyBackgroundPosition(pieceDiv, i);

      pieceDiv.addEventListener("click", onPieceClick);
      board.appendChild(pieceDiv);
    }
  }

  // â˜… ë³´ë“œ í¬ê¸°ì— ë§ì¶°ì„œ ì¡°ê°ì˜ background ìœ„ì¹˜ & í¬ê¸°ë¥¼ ê³„ì‚°
  function applyBackgroundPosition(div, pieceNum) {
    const row = Math.floor(pieceNum / COLS);
    const col = pieceNum % COLS;

    const boardWidth = board.clientWidth;
    const boardHeight = board.clientHeight;

    const tileWidth = boardWidth / COLS;
    const tileHeight = boardHeight / ROWS;

    const offsetX = col * tileWidth;
    const offsetY = row * tileHeight;

    div.style.backgroundImage = `url('${IMAGE_URL}')`;
    div.style.backgroundSize = `${boardWidth}px ${boardHeight}px`;
    div.style.backgroundPosition = `-${offsetX}px -${offsetY}px`;
  }

  function onPieceClick(e) {
    const clickedDiv = e.currentTarget;
    const idx = parseInt(clickedDiv.dataset.index, 10);

    if (selectedIndex === null) {
      selectedIndex = idx;
      clickedDiv.classList.add("selected");
    } else if (selectedIndex === idx) {
      clickedDiv.classList.remove("selected");
      selectedIndex = null;
    } else {
      swapPieces(selectedIndex, idx);
      clearSelection();
      moveCounter++;
      updateMoveCount();
      checkComplete();
    }
  }

  function clearSelection() {
    const tiles = document.querySelectorAll(".piece");
    tiles.forEach(t => t.classList.remove("selected"));
    selectedIndex = null;
  }

  function swapPieces(i, j) {
    const tiles = document.querySelectorAll(".piece");

    const tileA = tiles[i];
    const tileB = tiles[j];

    const pieceA = parseInt(tileA.dataset.piece, 10);
    const pieceB = parseInt(tileB.dataset.piece, 10);

    tileA.dataset.piece = pieceB;
    tileB.dataset.piece = pieceA;

    applyBackgroundPosition(tileA, pieceB);
    applyBackgroundPosition(tileB, pieceA);
  }

  // â˜… ê°€ì¥ìë¦¬ëŠ” ê³ ì •, ì•ˆìª½(1~8í–‰/ì—´)ë§Œ ì„ê¸°
  function shuffle() {
    const tiles = document.querySelectorAll(".piece");
    const interiorIndexes = [];

    for (let r = 1; r < ROWS - 1; r++) {
      for (let c = 1; c < COLS - 1; c++) {
        interiorIndexes.push(r * COLS + c);
      }
    }

    const interiorPieces = interiorIndexes.map(idx => {
      return parseInt(tiles[idx].dataset.piece, 10);
    });

    for (let i = interiorPieces.length - 1; i > 0; i--) {
      const r = Math.floor(Math.random() * (i + 1));
      [interiorPieces[i], interiorPieces[r]] =
        [interiorPieces[r], interiorPieces[i]];
    }

    interiorIndexes.forEach((tileIdx, i) => {
      const pieceNum = interiorPieces[i];
      const tile = tiles[tileIdx];
      tile.dataset.piece = pieceNum;
      applyBackgroundPosition(tile, pieceNum);
    });

    clearSelection();
    moveCounter = 0;
    updateMoveCount();
  }

  function resetPieces() {
    const tiles = document.querySelectorAll(".piece");
    tiles.forEach((tile, idx) => {
      tile.dataset.piece = idx;
      applyBackgroundPosition(tile, idx);
    });

    clearSelection();
    moveCounter = 0;
    updateMoveCount();
  }

  function checkComplete() {
    const tiles = document.querySelectorAll(".piece");
    let ok = true;

    tiles.forEach((tile, idx) => {
      const pieceNum = parseInt(tile.dataset.piece, 10);
      if (pieceNum !== idx) ok = false;
    });

    if (ok) {
      setTimeout(() => {
        alert("ğŸ‰ í¼ì¦ ì™„ì„±! ì´ë™ íšŸìˆ˜: " + moveCounter + "íšŒ");
      }, 100);
    }
  }

  function updateMoveCount() {
    moveCountSpan.textContent = "ì´ë™ íšŸìˆ˜: " + moveCounter;
  }

  // â˜… í™”ë©´ íšŒì „/í¬ê¸° ë³€ê²½ ì‹œ í¼ì¦ë„ ë‹¤ì‹œ ë§ê²Œ ê·¸ë¦¬ê¸°
  function redrawAllPieces() {
    const tiles = document.querySelectorAll(".piece");
    tiles.forEach(tile => {
      const pieceNum = parseInt(tile.dataset.piece, 10);
      applyBackgroundPosition(tile, pieceNum);
    });
  }

  document.getElementById("shuffleBtn").addEventListener("click", shuffle);
  document.getElementById("resetBtn").addEventListener("click", resetPieces);

  window.addEventListener("load", () => {
    init();
    // ì´ˆê¸° ë¡œë”© í›„ í•œ ë²ˆ ë” ë³´ì • (ë ˆì´ì•„ì›ƒ ì™„ë£Œ í›„)
    setTimeout(redrawAllPieces, 50);
  });

  window.addEventListener("resize", () => {
    redrawAllPieces();
  });
</script>

<!-- PWA ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js')
    .catch(err => console.log('SW registration failed', err));
}
</script>

</body>
</html>


